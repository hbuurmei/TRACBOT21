<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Software | TRACBOT21 </title> <meta name="author" content="Hugo Buurmeijer"> <meta name="description" content="Project website of TRACTBOT21. "> <meta name="keywords" content="mechatronics"> <link rel="stylesheet" href="/TRACBOT21/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/TRACBOT21/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/TRACBOT21/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/TRACBOT21/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://hbuurmei.github.io/TRACBOT21/software/"> <link defer rel="stylesheet" href="/TRACBOT21/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/TRACBOT21/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/TRACBOT21//"> TRACBOT21 </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/TRACBOT21/">Home </a> </li> <li class="nav-item "> <a class="nav-link" href="/TRACBOT21/approach/">Approach </a> </li> <li class="nav-item dropdown active"> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Design <span class="sr-only">(current)</span> </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/TRACBOT21/mechanical/">Mechanical</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/TRACBOT21/electrical/">Electrical</a> <div class="dropdown-divider"></div> <a class="dropdown-item active" href="/TRACBOT21/software/">Software</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/TRACBOT21/materials/">Materials </a> </li> <li class="nav-item "> <a class="nav-link" href="/TRACBOT21/results/">Results </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Software</h1> <p class="post-description"></p> </header> <article> <p>For this project, we made us of the <a href="https://platformio.org/" rel="external nofollow noopener" target="_blank">PlatformIO</a> ecosystem to develop the software for the robot. This allowed for easy version control, dependency management, and testing. Our GitHub repository can be found <a href="https://github.com/hbuurmei/TRACBOT21-PIO" rel="external nofollow noopener" target="_blank">here</a>.</p> <h3 id="state-diagram">State Diagram</h3> <hr> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/TRACBOT21/assets/img/state_diagram.drawio-480.webp 480w,/TRACBOT21/assets/img/state_diagram.drawio-800.webp 800w,/TRACBOT21/assets/img/state_diagram.drawio-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/TRACBOT21/assets/img/state_diagram.drawio.png" class="img-fluid rounded z-depth-0" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="libraries">Libraries</h3> <h4 id="timerinterrupt">TimerInterrupt</h4> <p>The <a href="https://github.com/khoih-prog/TimerInterrupt" rel="external nofollow noopener" target="_blank">TimerInterrupt</a> library is an open-source repository that allows users to directly interface with the hardware timers available on their Arduino board. This was especially relevant for us as it allowed us to repurpose a hardware timer for integrating IMU measurements, allowing for angle tracking in our software. Having a dedicated hardware timer proved to be far more precise than using <code class="language-plaintext highlighter-rouge">millis()</code> for the same purpose.</p> <p>A key learning experience from our project is that one must be extremely conscious of the timers being used by not only the user, but the Arduino itself. The PWM pins on the board use these timers, and one must be careful that you are not accidentially using the timer for two purposes. For example, we chose to perform IMU integration on ITimer1, but the standard Servo library on the Uno controls the Servos via pins 9 and 10, whos PWM also runs off of ITimer1. This led to integration issues and ultimatelly necessitated a last-minue wiring change to offload the Servos to an external breakout board. Another example is that initially we had the one motors enable pin connected to an ITimer0 pin, while the other was on ITimer2. When diagnositng issues driving in a straight line, we eventually moved both motors onto ITimer2, which improved consistency and straight line performance.</p> <h4 id="imu-processing">IMU Processing</h4> <p>The IMU processing class was developed in-house and inherits the open-source <a href="https://github.com/ElectronicCats/mpu6050" rel="external nofollow noopener" target="_blank">mpu6050</a> library and acts as a wrapper to improve ease of use. This library contains two key functions that expand upon the capabilities of the mpu6050 library:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">calibrate()</code> reads IMU data for an user specified amount the time. The arithmetic mean of this data is stored as the bias for each sensor. This bias is then used to correct the IMU raw measurements to greatly improve accuracy.</li> <li> <code class="language-plaintext highlighter-rouge">update_integrator()</code> is called at a fixed interval by ITimer1 to provide estimates of angles and position/velocity. It works by collecting the current bias-compensated measurements and integrating those measurements via a forward Euler approximation.</li> </ul> \[\theta_{z,n+1} = \theta_{z,n}+(\omega_{z,raw}-\omega_{z,bias})\Delta t\] <p>This function along with the ability to <code class="language-plaintext highlighter-rouge">reset_integrators()</code> is key in measuring our turns to a high degree of precision, necessary for many events in our state diagram.</p> <h4 id="beacon-processing">Beacon Processing</h4> <h4 id="line-sensor-processing">Line Sensor Processing</h4> <p>The line sensor processing was relatively straight forward in our software. We used hysterisis in order to remove chattering around a single threshold, and the min and max thresholds were turned experimentially such that we could detect line crossings. The software also kept running counters of the number of transitions between <code class="language-plaintext highlighter-rouge">on_line</code> and <code class="language-plaintext highlighter-rouge">off_line</code> states which was useful for debugging. The reliability of our sensor meant that this simple software implentation was very reliable, and it did not cause many issues during the project.</p> <h4 id="servo-commanding">Servo Commanding</h4> <h4 id="motor-commanding">Motor Commanding</h4> <p>The motor control library was developed in-house and provides a range of commanding capabilities for the motor driver. This simplified actions in our state diagram and provided developers with flexibility in how the robot could be maneuvered. Given the size of our robot, this maneuverability was critical to mission success.</p> <p>One key aspect of the commanding capabilities was three different turn modes, described below:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">FORWARD</code> executes a turn where one wheel stays fixed, and the other drives forward. This results in a shift of the vehicle center of mass forward while turning.</li> <li> <code class="language-plaintext highlighter-rouge">BACKWARD</code> is the opposite of forward, where one wheel drives backward results in the center of mass shifting backward as well.</li> <li> <code class="language-plaintext highlighter-rouge">MIDDDLE</code> has the wheels drive in opposite directions, minimizing the shift in center of mass.</li> </ul> <p>We found that while the <code class="language-plaintext highlighter-rouge">MIDDLE</code> turns were slightly less accurate due to a higher minimum turning speed, the value of keeping the center of mass in the same place was especially important to tuning the parameters in our software. Therefore, most turns were executed using the <code class="language-plaintext highlighter-rouge">MIDDLE</code> specification.</p> </article> <div id="giscus_thread" style="max-width: 1000px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"hbuurmei/TRACBOT21","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Hugo Buurmeijer. Last updated: March 15, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/TRACBOT21/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/TRACBOT21/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/TRACBOT21/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/TRACBOT21/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/TRACBOT21/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/TRACBOT21/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>